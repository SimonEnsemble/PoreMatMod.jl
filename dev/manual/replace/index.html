<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Substructure Find/Replace · PoreMatMod.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/flux.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.jpg" alt="PoreMatMod.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PoreMatMod.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">PoreMatMod</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../start/">Getting Started</a></li><li><a class="tocitem" href="../inputs/">Loading Data</a></li><li><a class="tocitem" href="../find/">Substructure Search</a></li><li class="is-active"><a class="tocitem" href>Substructure Find/Replace</a><ul class="internal"><li><a class="tocitem" href="#Documentation-of-functions"><span>Documentation of functions</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../../PoreMatModGO/">PoreMatModGO</a></li><li><a class="tocitem" href="../../collab/">Contribute/Report Issues</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Substructure Find/Replace</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Substructure Find/Replace</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/master/docs/src/manual/replace.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Find/Replace-Operations"><a class="docs-heading-anchor" href="#Find/Replace-Operations">Find/Replace Operations</a><a id="Find/Replace-Operations-1"></a><a class="docs-heading-anchor-permalink" href="#Find/Replace-Operations" title="Permalink"></a></h1><p>Suppose we wish to conduct the find-and-replace operations illustrated in the figure below, to produce an acetylamido-functionalized IRMOF-1 structure.</p><p><img src="../../assets/replace/rep_header.png" alt="replacement scheme"/></p><h4 id="the-parent-structure"><a class="docs-heading-anchor" href="#the-parent-structure">the <code>parent</code> structure</a><a id="the-parent-structure-1"></a><a class="docs-heading-anchor-permalink" href="#the-parent-structure" title="Permalink"></a></h4><p>First, we load the <code>parent</code> IRMOF-1 structure and infer its bonds.</p><pre><code class="language-julia hljs">parent = Crystal(&quot;IRMOF-1.cif&quot;)
infer_bonds!(parent, true)</code></pre><h4 id="the-query-fragment"><a class="docs-heading-anchor" href="#the-query-fragment">the <code>query</code> fragment</a><a id="the-query-fragment-1"></a><a class="docs-heading-anchor-permalink" href="#the-query-fragment" title="Permalink"></a></h4><p>Next, we define a <code>query</code> fragment as a <em>p</em>-phenylene moiety. To guide the replacement, the masked atoms of the <code>query</code> fragment must be annotated with <code>!</code> in the <code>.xyz</code> input file by appending a <code>!</code> character at the end of their atomic symbols. The atom property viewer feature in <a href="https://iraspa.org/">iRASPA</a> is useful for figuring out which atom(s) to mask.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>A masked atom (marked with <code>!</code>) in the <code>query</code> fragment implies that the corresponding atom of the <code>parent</code> crystal structure (i) must be removed [e.g., to make room for replacement with a different functionality] but (ii) does not correspond with an atom on the <code>replacement</code> fragment and thus cannot be used in the process of aligning the <code>replacement</code> fragment onto the <code>parent</code> crystal. </p></div></div><p>In our example, in <code>2-!-p-phenylene.xyz</code> input file describing our <em>p</em>-phenylene <code>query</code> fragment, one H atom is masked (see figure above):</p><pre><code class="nohighlight hljs">10

C         -1.71069        0.96969       -0.46280
C         -0.48337        1.30874        0.11690
C         -2.33707       -0.23371       -0.12103
C          0.11757        0.44439        1.03836
C         -0.50881       -0.75900        1.38013
C         -1.73613       -1.09805        0.80043
H!         1.06706        0.70670        1.48683
H          0.00122        2.23972       -0.14750
H         -3.28655       -0.49601       -0.56950
H         -2.22071       -2.02904        1.06484</code></pre><p>We then read the input file for the <code>query</code> fragment.</p><pre><code class="language-julia hljs">query = moiety(&quot;2-!-p-phenylene.xyz&quot;)</code></pre><h4 id="the-replacement-fragment"><a class="docs-heading-anchor" href="#the-replacement-fragment">the <code>replacement</code> fragment</a><a id="the-replacement-fragment-1"></a><a class="docs-heading-anchor-permalink" href="#the-replacement-fragment" title="Permalink"></a></h4><p>Next, we read in the acetylamido-functionalized version of the <code>query</code> fragment, <a href="../../assets/replace/2-acetylamido-p-phenylene.xyz">2-acetylamido-p-phenylene.xyz</a>, as the <code>replacement</code> fragment:</p><pre><code class="language-julia hljs">replacement = moiety(&quot;2-acetylamido-p-phenylene.xyz&quot;)</code></pre><h4 id="the-find-step"><a class="docs-heading-anchor" href="#the-find-step">the find step</a><a id="the-find-step-1"></a><a class="docs-heading-anchor-permalink" href="#the-find-step" title="Permalink"></a></h4><p>We search for subgraphs of the <code>parent</code> structure that match the <code>query</code> fragment. Note the <code>!</code> tags are ignored during the <code>substructure_search</code>.</p><pre><code class="language-julia hljs">search = query in parent # equivalent to substructure_search(query, parent)</code></pre><h4 id="the-replace-step"><a class="docs-heading-anchor" href="#the-replace-step">the replace step</a><a id="the-replace-step-1"></a><a class="docs-heading-anchor-permalink" href="#the-replace-step" title="Permalink"></a></h4><p>The code below will, at each location in the <code>parent</code> where a substructure matched the <code>query</code> fragment, choose a random orientation (corresponding to an overlay of the <code>query</code> with the substructure), align and install the replacement fragment, then remove the original substructure, giving the <code>child</code> structure shown in the figure above.</p><pre><code class="language-julia hljs">child = substructure_replace(search, replacement)</code></pre><p>To direct the number, location, and orientation of the replacements, use the keyword arguments for <a href="#PoreMatMod.substructure_replace"><code>substructure_replace</code></a>. Particularly, the location <code>loc</code> and orientation <code>ori</code> keyword arguments specify a particular isomorphism to use (in reference to <code>search.isomorphisms</code>) when conducting a replacement operation. The figure below illustrates.</p><p><img src="../../assets/replace/loc_ori_example.png" alt="loc/ori example"/></p><p>For more details, see the <a href="../find">search docs</a> and the <a href="../../examples/replacement_modes.html">replacement modes example</a>.</p><h3 id="quick-find-and-replace-syntax"><a class="docs-heading-anchor" href="#quick-find-and-replace-syntax">quick find-and-replace syntax</a><a id="quick-find-and-replace-syntax-1"></a><a class="docs-heading-anchor-permalink" href="#quick-find-and-replace-syntax" title="Permalink"></a></h3><p>For one-shot find-and-replace operations, the <code>replace</code> function may be used:</p><pre><code class="language-julia hljs">child = replace(parent, query =&gt; replacement)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Generally, it is advisable to perform the search using <code>substructure_replace</code> then pass it to <code>replace</code>, as multiple replacement tasks can then be performed on the basis of the search step as opposed to repeating it for each replacement. The search is usually the slowest step, and it is desirable not to perform it repeatedly.</p></div></div><h2 id="Documentation-of-functions"><a class="docs-heading-anchor" href="#Documentation-of-functions">Documentation of functions</a><a id="Documentation-of-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation-of-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PoreMatMod.substructure_replace" href="#PoreMatMod.substructure_replace"><code>PoreMatMod.substructure_replace</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">child = substructure_replace(search, replacement; random=false, nb_loc=0, loc=Int[], ori=Int[], name=&quot;new_xtal&quot;, verbose=false, remove_duplicates=false, periodic_boundaries=true)</code></pre><p>Replace the substructures of <code>search.parent</code> matching the <code>search.query</code> fragment with the <code>replacement</code> fragment, at locations and orientations specified by the keyword arguments <code>random</code>, <code>nb_loc</code>, <code>loc</code>, and <code>ori</code>. Default behavior is to effect replacements at all &quot;hit&quot; locations in the parent structure and, at each location, choose the orientation giving the optimal (lowest error) spatial aligment.</p><p>Returns a new <code>Crystal</code> with the specified modifications (returns <code>search.parent</code> if no replacements are made).</p><p><strong>Arguments</strong></p><ul><li><code>search::Search</code> the <code>Search</code> for a substructure moiety in the parent crystal</li><li><code>replacement::Crystal</code> the moiety to use for replacement of the searched substructure</li><li><code>random::Bool</code> set <code>true</code> to select random replacement orientations</li><li><code>nb_loc::Int</code> assign a value to select random replacement at <code>nb_loc</code> random locations</li><li><code>loc::Array{Int}</code> assign value(s) to select specific locations for replacement.  If <code>ori</code> is not specified, replacement orientation is random.</li><li><code>ori::Array{Int}</code> assign value(s) when <code>loc</code> is assigned to specify exact configurations for replacement. <code>0</code> values mean the configuration at that location should be selected for optimal alignment with the parent.</li><li><code>name::String</code> assign to give the generated <code>Crystal</code> a name (&quot;new_xtal&quot; by default)</li><li><code>verbose::Bool</code> set <code>true</code> to print console messages about the replacement(s) being performed</li><li><code>remove_duplicates::Bool</code> set <code>true</code> to automatically combine overlapping atoms of the same species in generated structures.</li><li><code>reinfer_bonds::Bool</code> set <code>true</code> to re-infer bonds after producing a structure</li><li><code>periodic_boundaries::Bool</code> set <code>false</code> to disable periodic boundary conditions when checking for atom duplication or re-inferring bonds</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/0f9a99c6466fd5b887bf81291001d48a17ad80de/src/replace.jl#L278-L300">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.replace" href="#Base.replace"><code>Base.replace</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">child = replace(parent, query =&gt; replacement)</code></pre><p>Generates a <code>child</code> crystal structure by (i) searches the <code>parent</code> crystal structure for subgraphs that match the <code>query</code> then  (ii) replaces the substructures of the <code>parent</code> matching the <code>query</code> fragment with the <code>replacement</code> fragment.</p><p>Equivalent to calling <code>substructure_replace(query ∈ parent, replacement)</code>.</p><p>Accepts the same keyword arguments as <a href="#PoreMatMod.substructure_replace"><code>substructure_replace</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/0f9a99c6466fd5b887bf81291001d48a17ad80de/src/replace.jl#L1-L10">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../find/">« Substructure Search</a><a class="docs-footer-nextpage" href="../../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Tuesday 14 December 2021 02:14">Tuesday 14 December 2021</span>. Using Julia version 1.6.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
