<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Substructure Search · PoreMatMod.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/flux.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.jpg" alt="PoreMatMod.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PoreMatMod.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">PoreMatMod</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../start/">Getting Started</a></li><li><a class="tocitem" href="../inputs/">Loading Data</a></li><li class="is-active"><a class="tocitem" href>Substructure Search</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Substructure-Searches:-how-to"><span>Substructure Searches: how to</span></a></li><li><a class="tocitem" href="#Molecular-and-Graph-Symmetry"><span>Molecular and Graph Symmetry</span></a></li><li><a class="tocitem" href="#Documentation-for-functions"><span>Documentation for functions</span></a></li></ul></li><li><a class="tocitem" href="../replace/">Substructure Find/Replace</a></li></ul></li><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../../PoreMatModGO/">PoreMatModGO</a></li><li><a class="tocitem" href="../../collab/">Contribute/Report Issues</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Substructure Search</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Substructure Search</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/master/docs/src/manual/find.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Subgraph-matching-(substructure-searches)"><a class="docs-heading-anchor" href="#Subgraph-matching-(substructure-searches)">Subgraph matching (substructure searches)</a><a id="Subgraph-matching-(substructure-searches)-1"></a><a class="docs-heading-anchor-permalink" href="#Subgraph-matching-(substructure-searches)" title="Permalink"></a></h1><p><code>PoreMatMod.jl</code> conducts subgraph matching, i.e. searches for subgraphs of a <code>parent</code> graph isomorphic to a <code>query</code> graph, using <a href="https://doi.org/10.1145/321921.321925">Ullmann&#39;s algorithm for subgraph isomorphisms</a>.</p><p>Both the <code>parent</code> crystal structure and <code>query</code> fragment are represented by node-labeled (by the chemical species) graphs. For crystals, bonds across the unit cell boundaries of periodic materials are accounted for, allowing us to find subgraph isomorphisms when the fragment is split across a unit cell boundary.</p><h1 id="Substructure-Searches:-how-to"><a class="docs-heading-anchor" href="#Substructure-Searches:-how-to">Substructure Searches: how to</a><a id="Substructure-Searches:-how-to-1"></a><a class="docs-heading-anchor-permalink" href="#Substructure-Searches:-how-to" title="Permalink"></a></h1><p>To learn by example, suppose we wish to search the IRMOF-1 crystal structure for <em>p</em>-phenylene fragments.</p><p>First, we load the <code>query</code> fragment and <code>parent</code> structure:</p><pre><code class="language-julia hljs">parent = Crystal(&quot;IRMOF-1.cif&quot;)
infer_bonds!(parent_xtal, true)

query = moiety(&quot;p-phenylene.xyz&quot;)</code></pre><p>then, we execute a search:</p><p>With a <code>parent</code> and <code>query</code> loaded, execute a search:</p><pre><code class="language-julia hljs">search = substructure_search(query, parent)
# output
p-phenylene.xyz ∈ IRMOF-1.cif
96 hits in 24 locations.</code></pre><div class="admonition is-info"><header class="admonition-header">Syntactic sugar for substructure search</header><div class="admonition-body"><p>The <code>∈</code> (<code>in</code> then hit <code>Tab</code> for this Unicode character) infix operator will also execute the search:</p><pre><code class="language-julia hljs">search = query ∈ parent
# output
p-phenylene.xyz ∈ IRMOF-1.cif
96 hits in 24 locations.</code></pre></div></div><p>This returns a <code>Search</code> object.   Its <code>search</code> attribute stores the <code>Crystal</code> data for the <code>query</code> and <code>parent</code> structures, and its <code>results</code> attribute is a vector listing the subgraph isomorphisms grouped by location.</p><pre><code class="language-julia hljs">search.search
# output
p-phenylene.xyz ∈ IRMOF-1.cif</code></pre><pre><code class="language-julia hljs">typeof(search.search.query)
# output
Crystal</code></pre><pre><code class="language-julia hljs">search.search.query.name
# output
&quot;p-phenylene.xyz&quot;</code></pre><pre><code class="language-julia hljs">search.results
# output
24-element Vector{Vector{Vector{Int64}}}:
 [[233, 306, 318, 245, 185, 197, 414, 329, 402, 341], [245, 318, 306, 233, 197, 185, 402, 341, 414, 329], [306, 233, 245, 318, 185, 197, 341, 402, 329, 414], [318, 245, 233, 306, 197, 185, 329, 414, 341, 402]]
 [[234, 305, 317, 246, 186, 198, 413, 330, 401, 342], [246, 317, 305, 234, 198, 186, 401, 342, 413, 330], [305, 234, 246, 317, 186, 198, 342, 401, 330, 413], [317, 246, 234, 305, 198, 186, 330, 413, 342, 401]]
 [[235, 308, 319, 248, 187, 200, 415, 331, 404, 344], [248, 319, 308, 235, 200, 187, 404, 344, 415, 331], [308, 235, 248, 319, 187, 200, 344, 404, 331, 415], [319, 248, 235, 308, 200, 187, 331, 415, 344, 404]]
 [[236, 307, 320, 247, 188, 199, 416, 332, 403, 343], [247, 320, 307, 236, 199, 188, 403, 343, 416, 332], [307, 236, 247, 320, 188, 199, 343, 403, 332, 416], [320, 247, 236, 307, 199, 188, 332, 416, 343, 403]]
 [[237, 262, 280, 255, 189, 207, 376, 333, 358, 351], [255, 280, 262, 237, 207, 189, 358, 351, 376, 333], [262, 237, 255, 280, 189, 207, 351, 358, 333, 376], [280, 255, 237, 262, 207, 189, 333, 376, 351, 358]]
 [[238, 261, 279, 256, 190, 208, 375, 334, 357, 352], [256, 279, 261, 238, 208, 190, 357, 352, 375, 334], [261, 238, 256, 279, 190, 208, 352, 357, 334, 375], [279, 256, 238, 261, 208, 190, 334, 375, 352, 357]]
 [[239, 264, 277, 254, 191, 206, 373, 335, 360, 350], [254, 277, 264, 239, 206, 191, 360, 350, 373, 335], [264, 239, 254, 277, 191, 206, 350, 360, 335, 373], [277, 254, 239, 264, 206, 191, 335, 373, 350, 360]]
 [[240, 263, 278, 253, 192, 205, 374, 336, 359, 349], [253, 278, 263, 240, 205, 192, 359, 349, 374, 336], [263, 240, 253, 278, 192, 205, 349, 359, 336, 374], [278, 253, 240, 263, 205, 192, 336, 374, 349, 359]]
 [[241, 290, 299, 252, 193, 204, 395, 337, 386, 348], [252, 299, 290, 241, 204, 193, 386, 348, 395, 337], [290, 241, 252, 299, 193, 204, 348, 386, 337, 395], [299, 252, 241, 290, 204, 193, 337, 395, 348, 386]]
 [[242, 289, 300, 251, 194, 203, 396, 338, 385, 347], [251, 300, 289, 242, 203, 194, 385, 347, 396, 338], [289, 242, 251, 300, 194, 203, 347, 385, 338, 396], [300, 251, 242, 289, 203, 194, 338, 396, 347, 385]]
 ⋮
 [[260, 283, 296, 271, 212, 219, 392, 356, 379, 367], [271, 296, 283, 260, 219, 212, 379, 367, 392, 356], [283, 260, 271, 296, 212, 219, 367, 379, 356, 392], [296, 271, 260, 283, 219, 212, 356, 392, 367, 379]]
 [[265, 314, 323, 276, 213, 224, 419, 361, 410, 372], [276, 323, 314, 265, 224, 213, 410, 372, 419, 361], [314, 265, 276, 323, 213, 224, 372, 410, 361, 419], [323, 276, 265, 314, 224, 213, 361, 419, 372, 410]]
 [[266, 313, 324, 275, 214, 223, 420, 362, 409, 371], [275, 324, 313, 266, 223, 214, 409, 371, 420, 362], [313, 266, 275, 324, 214, 223, 371, 409, 362, 420], [324, 275, 266, 313, 223, 214, 362, 420, 371, 409]]
 [[267, 316, 322, 273, 215, 221, 418, 363, 412, 369], [273, 322, 316, 267, 221, 215, 412, 369, 418, 363], [316, 267, 273, 322, 215, 221, 369, 412, 363, 418], [322, 273, 267, 316, 221, 215, 363, 418, 369, 412]]
 [[268, 315, 321, 274, 216, 222, 417, 364, 411, 370], [274, 321, 315, 268, 222, 216, 411, 370, 417, 364], [315, 268, 274, 321, 216, 222, 370, 411, 364, 417], [321, 274, 268, 315, 222, 216, 364, 417, 370, 411]]
 [[285, 310, 328, 303, 225, 231, 424, 381, 406, 399], [303, 328, 310, 285, 231, 225, 406, 399, 424, 381], [310, 285, 303, 328, 225, 231, 399, 406, 381, 424], [328, 303, 285, 310, 231, 225, 381, 424, 399, 406]]
 [[286, 309, 327, 304, 226, 232, 423, 382, 405, 400], [304, 327, 309, 286, 232, 226, 405, 400, 423, 382], [309, 286, 304, 327, 226, 232, 400, 405, 382, 423], [327, 304, 286, 309, 232, 226, 382, 423, 400, 405]]
 [[287, 312, 325, 302, 227, 230, 421, 383, 408, 398], [302, 325, 312, 287, 230, 227, 408, 398, 421, 383], [312, 287, 302, 325, 227, 230, 398, 408, 383, 421], [325, 302, 287, 312, 230, 227, 383, 421, 398, 408]]
 [[288, 311, 326, 301, 228, 229, 422, 384, 407, 397], [301, 326, 311, 288, 229, 228, 407, 397, 422, 384], [311, 288, 301, 326, 228, 229, 397, 407, 384, 422], [326, 301, 288, 311, 229, 228, 384, 422, 397, 407]]</code></pre><p>In this example, the <code>query</code> fragment (<em>p</em>-phenylene) occurs 24 times in the provided structure of the <code>parent</code> crystal (IRMOF-1), with 4 symmetry-equivalent search hits at each site, for a total of 96 subgraph isomorphisms.</p><p>Helper functions count the number of locations where the <code>query</code> occurs, the number of configurations at each location, and the total number of isomorphisms.</p><pre><code class="language-julia hljs">nb_locations(search) 
# output
24</code></pre><pre><code class="language-julia hljs">nb_ori_at_loc(search)  # 24-element Vector{Int64}: [4, 4, 4, ..., 4]</code></pre><pre><code class="language-julia hljs">nb_isomorphisms(search) 
# output
96</code></pre><p>To generate a <code>Crystal</code> containing only the substructures of the <code>parent</code> which are isomorphic to the <code>query</code>, use:</p><pre><code class="language-julia hljs">isomorphic_substructures(search)</code></pre><p><img src="../../assets/find/s_moty-in-xtal.png" alt="find graphic"/></p><h2 id="Molecular-and-Graph-Symmetry"><a class="docs-heading-anchor" href="#Molecular-and-Graph-Symmetry">Molecular and Graph Symmetry</a><a id="Molecular-and-Graph-Symmetry-1"></a><a class="docs-heading-anchor-permalink" href="#Molecular-and-Graph-Symmetry" title="Permalink"></a></h2><p>Due to the representation of molecules as graphs, <code>PoreMatMod.jl</code> may yield &quot;extra&quot; search results corresponding to different spatial isomers or moiety orientations. In some applications this may be advantageous, but in most cases it is advisable to search using the most minimal structure which uniquely matches the targeted parent moiety.</p><p>An example is searching for <a href="../../assets/find/BDC.xyz">BDC.xyz</a> in IRMOF-1 instead of the more minimal <em>p</em>-phenylene. Thanks to the two carboxyl groups, the total number of isomorphisms is multiplied by a factor of 4, due to the graph-equivalence of the oxygen atoms in each group.   The number of locations at which the isomorphisms are found, however, is unchanged.</p><pre><code class="language-julia hljs">query = moiety(&quot;BDC.xyz&quot;)
search = query ∈ parent
nb_isomorphisms(search) 
# output
384</code></pre><pre><code class="language-julia hljs">nb_locations(search) 
# output
24</code></pre><h3 id="Details-on-our-implementation-of-Ulmann&#39;s-algorithm"><a class="docs-heading-anchor" href="#Details-on-our-implementation-of-Ulmann&#39;s-algorithm">Details on our implementation of Ulmann&#39;s algorithm</a><a id="Details-on-our-implementation-of-Ulmann&#39;s-algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Details-on-our-implementation-of-Ulmann&#39;s-algorithm" title="Permalink"></a></h3><p>The algorithm is a depth-first search of the permutation tree for all possible one-to-one correspondences between the nodes of one graph (the <code>query</code>) and any subset of nodes of another graph (the <code>parent</code>).  The search tree is greatly reduced in size by imposing several constraints on possible node-to-node correspondences.  At each branch of the search tree, additional pruning further reduces the search space by comparing the immediate neighborhoods of potentially-corresponding nodes.</p><p><code>PoreMatMod.jl</code> augments Ullmann&#39;s algorithm to include the requirement that potentially-corresponding nodes be of the same atomic species, as required by the chemical structure application.  Additionally, the number of initial potential matches is reduced by further examination of each atom&#39;s local bonding neighborhood.  </p><h2 id="Documentation-for-functions"><a class="docs-heading-anchor" href="#Documentation-for-functions">Documentation for functions</a><a id="Documentation-for-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation-for-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PoreMatMod.Search" href="#PoreMatMod.Search"><code>PoreMatMod.Search</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">`search = Search(search_terms, results)`</code></pre><p>Stores the <code>SearchTerms</code> used for a substructure search, and the results returned by carrying out the search. Results are grouped by location in the parent <code>Crystal</code> and can be examined using <code>nb_isomorphisms</code>, <code>nb_locations</code>, and <code>nb_ori_at_loc</code>. Subgraph isomorphisms are encoded like</p><pre><code class="nohighlight hljs">`isom = search.results[i][j] = [7, 21, 9]`</code></pre><p>where <code>isom[k]</code> is the index of the atom in <code>search.search.parent</code> corresponding to atom <code>k</code> in <code>search.search.query</code> for location <code>i</code> and orientation <code>j</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/4ed73f995d9ba192dc1ba26807d38eeb241ccbad/src/search.jl#L14-L24">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PoreMatMod.SearchTerms" href="#PoreMatMod.SearchTerms"><code>PoreMatMod.SearchTerms</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">`SearchTerms(parent, query)`</code></pre><p>Stores the <code>Crystal</code> inputs used to generate a <code>Search</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/4ed73f995d9ba192dc1ba26807d38eeb241ccbad/src/search.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PoreMatMod.substructure_search" href="#PoreMatMod.substructure_search"><code>PoreMatMod.substructure_search</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">`substructure_search(query, parent; disconnected_component=false)`</code></pre><p>Searches for a substructure within a <code>Crystal</code> and returns a <code>Search</code> struct containing all identified subgraph isomorphisms.  Matches are made on the basis of atomic species and chemical bonding networks, including bonds across unit cell periodic boundaries.  The search moiety may optionally contain markup for designating atoms to replace with other moieties.</p><p><strong>Arguments</strong></p><ul><li><code>query::Crystal</code> the search moiety</li><li><code>parent::Crystal</code> the parent structure</li><li><code>disconnected_component::Bool=false</code> if true, disables substructure searching (e.g. for finding guest molecules)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/4ed73f995d9ba192dc1ba26807d38eeb241ccbad/src/search.jl#L97-L110">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PoreMatMod.nb_ori_at_loc" href="#PoreMatMod.nb_ori_at_loc"><code>PoreMatMod.nb_ori_at_loc</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">`nb_ori_at_loc(search)`</code></pre><p>Returns a array containing the number of isomorphic configurations at a given location (collection of atoms) for which the specified <code>Search</code> results contain isomorphisms.</p><p><strong>Arguments</strong></p><ul><li><code>search::Search</code> a substructure <code>Search</code> object</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/4ed73f995d9ba192dc1ba26807d38eeb241ccbad/src/search.jl#L63-L72">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PoreMatMod.nb_isomorphisms" href="#PoreMatMod.nb_isomorphisms"><code>PoreMatMod.nb_isomorphisms</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">`nb_isomorphisms(search::Search)`</code></pre><p>Returns the number of isomorphisms found in the specified <code>Search</code></p><p><strong>Arguments</strong></p><ul><li><code>search::Search</code> a substructure <code>Search</code> object</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/4ed73f995d9ba192dc1ba26807d38eeb241ccbad/src/search.jl#L36-L43">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PoreMatMod.nb_locations" href="#PoreMatMod.nb_locations"><code>PoreMatMod.nb_locations</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">`nb_locations(search::Search)`</code></pre><p>Returns the number of unique locations (collections of atoms) at which the specified <code>Search</code> results contain isomorphisms.</p><p><strong>Arguments</strong></p><ul><li><code>search::Search</code> a substructure <code>Search</code> object</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/4ed73f995d9ba192dc1ba26807d38eeb241ccbad/src/search.jl#L49-L57">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PoreMatMod.isomorphic_substructures" href="#PoreMatMod.isomorphic_substructures"><code>PoreMatMod.isomorphic_substructures</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>iso_structs = isomorphic_substructures(s::Search)::Crystal</code></p><p>Returns a crystal consisting of the atoms involved in subgraph isomorphisms in the search <code>s</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/4ed73f995d9ba192dc1ba26807d38eeb241ccbad/src/search.jl#L87-L91">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../inputs/">« Loading Data</a><a class="docs-footer-nextpage" href="../replace/">Substructure Find/Replace »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.7 on <span class="colophon-date" title="Tuesday 28 September 2021 21:21">Tuesday 28 September 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
