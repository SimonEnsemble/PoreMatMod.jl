<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Substructure Find/Replace · PoreMatMod.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/flux.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.jpg" alt="PoreMatMod.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PoreMatMod.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">PoreMatMod</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../start/">Getting Started</a></li><li><a class="tocitem" href="../inputs/">Loading Data</a></li><li><a class="tocitem" href="../find/">Substructure Search</a></li><li class="is-active"><a class="tocitem" href>Substructure Find/Replace</a><ul class="internal"><li><a class="tocitem" href="#Inputs"><span>Inputs</span></a></li><li><a class="tocitem" href="#Replacement-Modes"><span>Replacement Modes</span></a></li><li><a class="tocitem" href="#Simple-syntax"><span>Simple syntax</span></a></li><li><a class="tocitem" href="#Orthogonal-Procrustes"><span>Orthogonal Procrustes</span></a></li><li><a class="tocitem" href="#The-Find-Replace-Algorithm"><span>The Find-Replace Algorithm</span></a></li><li><a class="tocitem" href="#Documentation-of-functions"><span>Documentation of functions</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../../PoreMatModGO/">PoreMatModGO</a></li><li><a class="tocitem" href="../../collab/">Contribute/Report Issues</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Substructure Find/Replace</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Substructure Find/Replace</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/master/docs/src/manual/replace.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Find/Replace-Operations"><a class="docs-heading-anchor" href="#Find/Replace-Operations">Find/Replace Operations</a><a id="Find/Replace-Operations-1"></a><a class="docs-heading-anchor-permalink" href="#Find/Replace-Operations" title="Permalink"></a></h1><p>Next, we learn to effect a substructure replacement. To learn by example, we tackle the problem of replacing the BDC linkers of IRMOF-1 with the 2-acetylamido-BDC linker.</p><p>First, we perform a search using a <code>query</code> with <code>!</code>-tagged atom(s), to direct the replacement stage of the algorithm. In this case, we should use <a href="../../assets/replace/2-!-p-phenylene.xyz">2-!-p-phenylene.xyz</a>. Having performed a search and chosen one or more isomorphisms from the results, we have the 1-to-1 correspondence(s) we need to perform OP to align the coordinate systems of the <code>parent</code> and <code>query</code>.   Such a correspondence will be termed <span>$q→p′$</span>.  We also need to align the <code>replacement</code> moiety, 2-acetylamido-<em>p</em>-phenylene, with the <code>query</code>, so we perform a second UA.</p><p>The <code>query</code> in this case is the original search moiety minus the subset of atoms tagged with <code>!</code>.  For 2-!-<em>p</em>-phenylene, this new search term is 1,2,4-dehydro-benzene, by deletion of the <code>:H!</code> at the 2 position of <em>p</em>-phenylene. Performing the second UA (seeking 1,2,4-dehydro-benzene in 2-acetylamido-<em>p</em>-phenylene) affords a second 1-to-1 correspondence, <span>$q′→r$</span>, the inverse of which is <span>$r′→q′$</span>. Chaining these together, we have <span>$r′→p′$</span>, the 1-to-1 correspondence for matching a subset of the <code>replacement</code> to a subset of the <code>parent</code>.</p><p>OP with <span>$r′→q′$</span> gives a rotation matrix which transforms the <code>replacement</code> by multiplication to align it with the coordinates of the parent crystal such that it can replace the linker at the chosen location.  The transformed replacement moiety is added to the crystal, overwriting the original location&#39;s atoms.</p><p><code>PoreMatMod.jl</code> does all of this in one line of user code. Bonds, including any across periodic boundaries, are preserved, the unit cell&#39;s dimensions are maintained, and the new structure can be saved to disk for use in simulations.</p><h2 id="Inputs"><a class="docs-heading-anchor" href="#Inputs">Inputs</a><a id="Inputs-1"></a><a class="docs-heading-anchor-permalink" href="#Inputs" title="Permalink"></a></h2><p>To guide replacement, the <code>.xyz</code> file input for the search moiety must be altered.   Simply adding <code>!</code> after the atomic symbol tags that atom for replacement. The atom property viewer feature in <a href="https://iraspa.org/">iRASPA</a> is conducive to this task.</p><p>In the example of finding and replacing the 2 position H of the <em>p</em>-phenylene moieties of IRMOF-1, the input should have one H atom tagged, like so:</p><pre><code class="nohighlight hljs">H!         1.06706        0.70670        1.48683</code></pre><p>Load the new file in like before.</p><pre><code class="language-julia hljs">query = moiety(&quot;2-!-p-phenylene.xyz&quot;)
search = query in parent</code></pre><p>The <code>!</code> tag does not affect the outcome of <code>substructure_search</code>.</p><pre><code class="language-julia hljs">s1 = substructure_search(moiety(&quot;p-phenylene.xyz&quot;), parent) 
s2 = substructure_search(moiety(&quot;2-!-p-phenylene.xyz&quot;), parent)

nb_isomorphisms(s1) == nb_isomorphisms(s2) &amp;&amp;
nb_locations(s1) == nb_locations(s2) &amp;&amp;
isequal(nb_configs_at_loc(s1), nb_configs_at_loc(s2))
# output
true</code></pre><p>A final additional file input is required: a <code>.xyz</code> file containing the <code>replacement</code>.   This structure must contain a subgraph isomorphic to the non-tagged atoms of the <code>query</code>.</p><p>To replace <em>p</em>-phenylene moieties with 2-acetylamido-<em>p</em>-phenylene moieties, load <a href="../../assets/replace/2-acetylamido-p-phenylene.xyz">2-acetylamido-p-phenylene.xyz</a>:</p><pre><code class="language-julia hljs">replacement = moiety(&quot;2-acetylamido-p-phenylene.xyz&quot;)</code></pre><h2 id="Replacement-Modes"><a class="docs-heading-anchor" href="#Replacement-Modes">Replacement Modes</a><a id="Replacement-Modes-1"></a><a class="docs-heading-anchor-permalink" href="#Replacement-Modes" title="Permalink"></a></h2><p>With all three file inputs loaded (IRMOF-1 as <code>parent</code>, 2-!-<em>p</em>-phenylene as <code>query</code>, and 2-acetylamido-<em>p</em>-phenylene as <code>replacement</code>) and a <code>search</code> performed, replacements can be made.</p><p><code>PoreMatMod.jl</code> has several replacement modes, one of which must be specified.</p><h3 id="Optimal-orientation-at-each-location"><a class="docs-heading-anchor" href="#Optimal-orientation-at-each-location">Optimal orientation at each location</a><a id="Optimal-orientation-at-each-location-1"></a><a class="docs-heading-anchor-permalink" href="#Optimal-orientation-at-each-location" title="Permalink"></a></h3><p>Optimal configurations will be chosen for each location in <code>search.results</code>, so that each occurrence of the <code>query</code> in the <code>parent</code> is replaced with minimal perturbation of the conserved atoms from the parent structure.</p><pre><code class="language-julia hljs">substructure_replace(search, replacement)</code></pre><h3 id="Optimal-orientation-at-n-random-locations"><a class="docs-heading-anchor" href="#Optimal-orientation-at-n-random-locations">Optimal orientation at n random locations</a><a id="Optimal-orientation-at-n-random-locations-1"></a><a class="docs-heading-anchor-permalink" href="#Optimal-orientation-at-n-random-locations" title="Permalink"></a></h3><p>The <code>parent</code> will be modified using optimal configurations at each of <span>$n$</span> randomly-selected locations.</p><pre><code class="language-julia hljs">substructure_replace(search, replacement, nb_loc=4)</code></pre><h3 id="Optimal-orientation-at-specific-locations"><a class="docs-heading-anchor" href="#Optimal-orientation-at-specific-locations">Optimal orientation at specific locations</a><a id="Optimal-orientation-at-specific-locations-1"></a><a class="docs-heading-anchor-permalink" href="#Optimal-orientation-at-specific-locations" title="Permalink"></a></h3><p>The <code>parent</code> is modified using optimal configurations at a list of specified locations.</p><pre><code class="language-julia hljs">substructure_replace(search, replacement, loc=[13, 20])</code></pre><h3 id="Specific-orientations-at-specific-locations"><a class="docs-heading-anchor" href="#Specific-orientations-at-specific-locations">Specific orientations at specific locations</a><a id="Specific-orientations-at-specific-locations-1"></a><a class="docs-heading-anchor-permalink" href="#Specific-orientations-at-specific-locations" title="Permalink"></a></h3><p>Specific replacements are made by providing the values of <code>loc</code> and <code>ori</code>. If any values in <code>ori</code> are zero, the corresponding location will processed with the optimal replacement.</p><pre><code class="language-julia hljs">substructure_replace(search, replacement, loc=[13, 20], ori=[1, 0])</code></pre><h3 id="Random-orientations"><a class="docs-heading-anchor" href="#Random-orientations">Random orientations</a><a id="Random-orientations-1"></a><a class="docs-heading-anchor-permalink" href="#Random-orientations" title="Permalink"></a></h3><p>By using the <code>random</code> keyword argument, the search for optimal alignment can be skipped, with the value of <code>ori</code> being selected at random.</p><pre><code class="language-julia hljs">substructure_replace(search, replacement, nb_loc=3, random=true)</code></pre><h2 id="Simple-syntax"><a class="docs-heading-anchor" href="#Simple-syntax">Simple syntax</a><a id="Simple-syntax-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-syntax" title="Permalink"></a></h2><p>Generally, it is advisable to perform the <code>search</code> and use <code>substructure_replace</code>, as multiple replacement tasks can be performed with a single searching step. The search is usually the slowest step, and it is desirable not to perform it repeatedly. However, for one-shot find-and-replace operations, the <code>replace</code> function syntax from standard <code>Julia</code> may be used:</p><pre><code class="language-julia hljs">replace(parent, query =&gt; replacement)</code></pre><p>Note it is still required to specify a replacement style via keyword argument.</p><h2 id="Orthogonal-Procrustes"><a class="docs-heading-anchor" href="#Orthogonal-Procrustes">Orthogonal Procrustes</a><a id="Orthogonal-Procrustes-1"></a><a class="docs-heading-anchor-permalink" href="#Orthogonal-Procrustes" title="Permalink"></a></h2><p>The question of how best to align crystal fragments in space is addressed by the <a href="https://simonensemble.github.io/2018-10/orthogonal-procrustes.html">&quot;Orthogonal Procrustes&quot;</a> problem.  If two point sets <span>$A$</span> and <span>$B$</span> have a known 1-to-1 correspondence mapping each point in <span>$A$</span> to a unique point in <span>$B$</span>, and <span>$A$</span> is a &quot;noisy&quot; rotated copy of <span>$B$</span>, we wish to find <span>$R$</span>, the rotation matrix that transforms <span>$A$</span> to reconstruct <span>$B$</span> with the minimum error.  This is accomplished via singular value decomposition of <span>$ABᵀ$</span>.  In the linked example <span>$A$</span> and <span>$B$</span> are two-dimensional for the purpose of visualization, but the solution to the problem is the same for point sets in any <span>$n$</span>-dimensional space.  In <code>PoreMatMod.jl</code> the solution is applied three-dimensionally, using the subgraph isomorphism identified by Ullmann&#39;s algorithm as the 1-to-1 correspondence.</p><h2 id="The-Find-Replace-Algorithm"><a class="docs-heading-anchor" href="#The-Find-Replace-Algorithm">The Find-Replace Algorithm</a><a id="The-Find-Replace-Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#The-Find-Replace-Algorithm" title="Permalink"></a></h2><h2 id="Documentation-of-functions"><a class="docs-heading-anchor" href="#Documentation-of-functions">Documentation of functions</a><a id="Documentation-of-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation-of-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PoreMatMod.substructure_replace" href="#PoreMatMod.substructure_replace"><code>PoreMatMod.substructure_replace</code></a> — <span class="docstring-category">Function</span></header><section><div><p>substructure<em>replace(search, replacement, nb</em>loc=2)</p><p>Inserts <code>replacement</code> into a parent structure according to <code>search</code> and <code>kwargs</code>. Provide a replacement style <code>kwarg</code> to direct the location and orientation of replacements. Default behavior is to seek the replacement operation with lowest RMSD on spatial alignment. Returns a new <code>Crystal</code> with the specified modifications (returns <code>search.search.parent</code> if no replacements are made)</p><p><strong>Arguments</strong></p><ul><li><code>search::Search</code> the <code>Search</code> for a substructure moiety in the parent crystal</li><li><code>replacement::Crystal</code> the moiety to use for replacement of the searched substructure</li><li><code>random::Bool</code> set <code>true</code> to select random replacement orientations</li><li><code>nb_loc::Int</code> assign a value to select random replacement at <code>nb_loc</code> random locations</li><li><code>loc::Array{Int}</code> assign value(s) to select specific locations for replacement.  If <code>ori</code> is not specified, replacement orientation is random.</li><li><code>ori::Array{Int}</code> assign value(s) when <code>loc</code> is assigned to specify exact configurations for replacement. <code>0</code> values mean the configuration at that location should be selected for optimal alignment with the parent.</li><li><code>name::String</code> assign to give the generated <code>Crystal</code> a name (&quot;new_xtal&quot; by default)</li><li><code>verbose::Bool</code> set <code>true</code> to print console messages about the replacement(s) being performed</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PoreMatMod.jl/blob/2f25268d087b81ab76bacf50b73d48dede9bc4ff/src/replace.jl#L216-L233">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../find/">« Substructure Search</a><a class="docs-footer-nextpage" href="../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.6 on <span class="colophon-date" title="Friday 17 September 2021 16:12">Friday 17 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
